<template>
    <div class="main-container">
        <!-- <div id="mask">
            <svg width="0" height="0" viewBox="0 0 1440 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                <defs>
                    <clipPath id="image-mask">
                        <polygon id="start" points="0 -2.48689958e-13 90.1775167 -1.13686838e-13 184.527045 -1.13686838e-13 253.153098 -1.13686838e-13 324.415139 -1.13686838e-13 378.435223 -1.13686838e-13 475.475738 -1.13686838e-13 539.961207 -1.13686838e-13 605.464143 -1.13686838e-13 655.005797 -1.13686838e-13 720 -1.13686838e-13 775.895918 -1.13686838e-13 858.53125 -1.13686838e-13 955.594901 -1.13686838e-13 1030.43183 -1.13686838e-13 1109.89254 -1.13686838e-13 1197.01562 -1.13686838e-13 1331.17807 -1.13686838e-13 1440 -2.48689958e-13"></polygon>
                    </clipPath>
                </defs>
                <path id="step-3" d="M-19.9877329,0 C-20.779393,1242.5625 15.9461409,1856.91146 90.1888689,1843.04688 C201.552961,1822.25 103.195851,1321.76562 184.537614,1321.76562 C265.879376,1321.76562 184.537614,1598.27636 253.163096,1636.14063 C321.788579,1674.00489 286.307134,1366.70313 324.424546,1366.70313 C362.541957,1366.70313 327.001586,1781.43068 378.444181,1788.85938 C429.886777,1796.28807 431.155655,1282.46875 475.48389,1282.46875 C519.812126,1282.46875 493.020335,1939.17188 539.968824,1939.17188 C586.917312,1939.17188 581.868059,1359.99837 605.471217,1366.70313 C629.074374,1373.40788 609.428735,1716.0276 655.012459,1703.5625 C668.512107,1699.87095 683.727051,1346.2479 720.006122,1321.76562 C741.81501,1307.04829 761.623199,1823.35012 775.901576,1788.85938 C818.073798,1686.98845 806.089483,1250.64745 834.415318,1247.5 C888.285082,1241.51422 905.729072,1601.40783 955.599066,1557 C1005.46906,1512.59217 990.83654,1747.78435 1030.43537,1754.39062 C1070.03421,1760.9969 1006.69203,1489.5273 1109.89543,1432.15625 C1213.09882,1374.7852 1141.09024,1688.95616 1235.70292,1788.85938 C1330.31559,1888.76259 1158.48362,1429.23438 1331.17912,1636.14063 C1446.30945,1774.07813 1482.58312,1228.69792 1440.00014,0 L-19.9877329,0 Z"></path>

                <path id="step-2" d="M0,0 C24.3442519,442.335645 54.4034241,659.140125 90.1775167,650.413442 C143.838656,637.323417 103.184607,153.657303 184.527045,153.657303 C265.869483,153.657303 184.527045,457.129887 253.153098,494.994148 C321.77915,532.85841 286.297411,223.143686 324.415139,223.143686 C362.532867,223.143686 326.9922,817.085692 378.435223,824.514387 C429.878245,831.943081 431.147134,446.220588 475.475738,446.220588 C519.804341,446.220588 493.012328,803.446122 539.961207,803.446122 C586.910085,803.446122 581.86079,509.402922 605.464143,516.107672 C629.067497,522.812423 609.421695,711.08845 655.005797,698.623352 C668.505558,694.931805 683.720628,618.711058 720,594.228783 C741.809069,579.511449 761.617423,567.015401 775.895918,532.524655 C818.06849,430.653735 806.084075,345.715944 834.410146,342.568495 C888.280357,336.582713 905.724492,617.84334 955.594901,573.435509 C1005.46531,529.027679 990.832666,312.760808 1030.43183,319.367083 C1070.03099,325.973359 1006.68829,793.837139 1109.89254,736.466088 C1213.09679,679.095038 1141.08762,150.248547 1235.70108,250.151764 C1330.31454,350.05498 1239.28382,880.537979 1331.17807,989.984532 C1392.4409,1062.9489 1428.71488,732.954056 1440,0 L0,0 Z"></path>

                <path id="step-1" d="M0,-1.35447209e-13 C24.3442519,144.070433 54.4034241,211.742308 90.1775167,203.015625 C143.838656,189.9256 103.184607,75.3984375 184.527045,75.3984375 C265.869483,75.3984375 184.527045,262.659176 253.153098,300.523437 C321.77915,338.387699 286.297411,223.143686 324.415139,223.143686 C362.532867,223.143686 326.9922,293.094743 378.435223,300.523437 C429.878245,307.952132 431.147134,85.375 475.475738,85.375 C519.804341,85.375 493.012328,203.015625 539.961207,203.015625 C586.910085,203.015625 581.86079,94.7561869 605.464143,101.460937 C629.067497,108.165688 609.421695,197.621348 655.005797,185.15625 C668.505558,181.464703 683.720628,24.4822753 720,6.43929354e-15 C741.809069,-14.7173337 732.380489,101.460938 775.895918,101.460937 C850.679688,101.460937 822.796875,175.945312 858.53125,175.945312 C894.265625,175.945312 905.724492,91.821893 955.594901,47.4140625 C1005.46531,3.006232 990.832666,169.339037 1030.43183,175.945312 C1070.03099,182.551588 1057.27727,59.3984375 1109.89254,59.3984375 C1162.50781,59.3984375 1157.66202,101.460937 1197.01563,101.460937 C1236.36923,101.460937 1239.28382,-34.0481152 1331.17807,75.3984375 C1392.4409,148.362806 1428.71488,123.229993 1440,-1.35447209e-13 L0,-1.35447209e-13 Z"></path>

            </svg>
        </div> -->
        <div ref="heroImg" id="hero-img" class="w-100" :style="'background-image: url('+article.featured_img+');'">
        </div>
        <article ref="article">
            <h1 id="title" ref="title" class="text-default">{{ article.title }}</h1>
            <hr class="pb-3" ref="divider">
            <p v-html="article.html" ref="html" class="text-default"></p>
        </article>
    </div>
</template>
<script>
import axios from 'axios'
import _ from 'lodash'
import {TweenMax, TimelineMax} from 'gsap'
import MorphSVG from 'gsap/MorphSVGPlugin'

export default {
    data: function() {
        return {
            article: {},
            firstLoad: true,
            image: {
                height: 0,
            }
        }
    },
    methods: {
        animateIn: function() {
            MorphSVG.convertToPath('#start')
            MorphSVG.convertToPath('#step-3')

            var t1 = new TimelineMax()
            t1.to('#start', 2, {
                    morphSVG: '#step-3',
                    ease: Power0.easeNone
                })
                .to('#start', 1, {
                    morphSVG: '#step-3',
                    ease: Power0.easeNone
                })
        },
        resizeFeatured: function() {
            if (this.$refs.heroImg && this.$refs.article) {
                if (this.firstLoad) {
                    // this.animateIn()
                }
                var height = window.innerHeight
                var gold = 1.618
                var imgHeight = (height / gold) - 64
                this.$refs.heroImg.style.height = `${imgHeight}px`
                this.$refs.article.style.marginTop = `${imgHeight - 32}px`

                var spaceLeft = height - imgHeight
                var titleHeight = (spaceLeft / gold / 1.11) - 64
                this.$refs.title.style.lineHeight = `${titleHeight}px`
            }
        }
    },
    mounted() {
        // console.log('open')
        axios.get('/api/search-post/' + this.$route.params.slug).then(response => {
            this.article = response.data.data
            this.loaded = true
            this.$nextTick(() => {
                this.resizeFeatured()
                // console.log('loaded')
            })
        })
        window.addEventListener('resize', _.debounce(() => {
            this.resizeFeatured()
        }, 250))
    },
}
</script>
<style lang="scss" scoped>
@import '~styles/custom-variables';

    .main-container {
        width: 100%;

        #hero-img {
            min-height: 140px;
            background-size: cover !important;
            background-position: center center !important;
            box-shadow: inset 0 0 5rem rgba(0, 0, 0, .05);
            position: absolute;
            left: 0;
            top: 72px;

            // opacity: 0;
            clip-path: url(#image-mask);

            transition: $transition-base;
        }

        .hero_img {
            overflow: hidden;
            min-height: 100px;
        }

        > article {

            > #title {
                font-size: 3.75rem;
                // line-height: 4rem;
                margin-bottom: 0;
            }
        }
    }
</style>
